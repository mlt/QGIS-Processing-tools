<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>QGIS processing tools</title>
  <link href="http://mlt.github.io/QGIS-Processing-toolsindex.xml" rel="self" />
  <link href="http://mlt.github.io/QGIS-Processing-tools"/>
  <updated>2015-03-20T14:46:29Z</updated>
  <id>http://mlt.github.io/QGIS-Processing-toolsindex.xml</id>
  <entry><title type="html">Meanders formation</title><author><name>nil</name></author><link href="http://mlt.github.io/QGIS-Processing-tools/posts/2015/03/meanders-formation/index.html"/><updated>2015-03-18T23:14:00Z</updated><published>2015-03-18T23:14:00Z</published><id>posts/2015/03/meanders-formation/index.html</id><category scheme="/tags/channel-migration.html" term="channel migration" label="channel migration"/><category scheme="/tags/r.html" term="r" label="r"/><content type="html">&lt;p&gt;
Accurate channel digitizing implies following actual flow path
including either emerging meanders in recent data or oxbow lakes that
used to be a channel in the past. Connecting such segments may give a
false impression of tremendous channel migration. These cases can be
detected by analyzing curvature changes.
&lt;/p&gt;

&lt;p&gt;
We are likely dealing with formation or collapse of a meander when the
largest curvature changes between past and recent data in about at
least an order of magnitude and either curvature is large enough for a
visible meander.
&lt;/p&gt;

&lt;p&gt;
The following plot might give you an idea how to pinpoint such cases.
&lt;/p&gt;

&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R" id="oxbow"&gt;&lt;span class="org-constant"&gt;library&lt;/span&gt;(rgdal)
&lt;span class="org-constant"&gt;library&lt;/span&gt;(ggplot2)
&lt;span class="org-constant"&gt;library&lt;/span&gt;(grid)
Original &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; readOGR(&lt;span class="org-string"&gt;".."&lt;/span&gt;, &lt;span class="org-string"&gt;"lower_mn_1938"&lt;/span&gt;)
Final &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; readOGR(&lt;span class="org-string"&gt;".."&lt;/span&gt;, &lt;span class="org-string"&gt;"lower_mn_2009"&lt;/span&gt;)
Years &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 71
spar &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 0.4
Step_pattern &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="org-string"&gt;'symmetricP05'&lt;/span&gt;
Curvature_multiplier &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 1e5
Step &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 25
&lt;span class="org-constant"&gt;source&lt;/span&gt;(&lt;span class="org-string"&gt;'~/.qgis2/processing/rscripts/Channel migration.rsx'&lt;/span&gt;)
Min_curvature &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 1e-3
&lt;span class="org-constant"&gt;source&lt;/span&gt;(&lt;span class="org-string"&gt;'~/.qgis2/processing/rscripts/Meander enumeration.rsx'&lt;/span&gt;)
&lt;span class="org-constant"&gt;source&lt;/span&gt;(&lt;span class="org-string"&gt;'~/.qgis2/processing/rscripts/Meander summary.rsx'&lt;/span&gt;)
transp &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; element_rect(fill=&lt;span class="org-string"&gt;'transparent'&lt;/span&gt;)
qplot(abs(c_from)+abs(c_to), log10(abs(c_from/c_to)), size=len, data=Meanders@data) +
  annotation_custom(grob=rectGrob(gp=gpar(fill=&lt;span class="org-string"&gt;'gray60'&lt;/span&gt;,alpha=.2)), xmin=.005, ymin=-3, xmax=.05, ymax=-1) +
  annotation_custom(grob=rectGrob(gp=gpar(fill=&lt;span class="org-string"&gt;'gray60'&lt;/span&gt;,alpha=.2)), xmin=.005, ymin=1, xmax=.05, ymax=3) +
  annotate(&lt;span class="org-string"&gt;'text'&lt;/span&gt;, .02, 1.5, label=&lt;span class="org-string"&gt;'collapsing meanders'&lt;/span&gt;, size=8) +
  annotate(&lt;span class="org-string"&gt;'text'&lt;/span&gt;, .02, -1.5, label=&lt;span class="org-string"&gt;'emergin meanders'&lt;/span&gt;, size=8) +
  theme_bw() %+replace%
  theme(plot.background=element_rect(fill=&lt;span class="org-string"&gt;'transparent'&lt;/span&gt;, colour=&lt;span class="org-string"&gt;'transparent'&lt;/span&gt;),
        legend.background=transp, legend.key=transp, panel.background=transp)
&lt;/pre&gt;
&lt;/div&gt;


&lt;div class="figure"&gt;
&lt;p&gt;&lt;img src="../../../.././posts/2015/03/meanders-formation/index/oxbow.svg" alt="oxbow.svg" /&gt;
&lt;/p&gt;
&lt;p&gt;&lt;span class="figure-number"&gt;Figure 1:&lt;/span&gt; Change in maximum curvature for meanders&lt;/p&gt;
&lt;/div&gt;
</content></entry><entry><title type="html">How to find an optimal curvature threshold</title><author><name>nil</name></author><link href="http://mlt.github.io/QGIS-Processing-tools/posts/2015/03/how-to-find-an-optimal-curvature-threshold/index.html"/><updated>2015-03-18T23:13:00Z</updated><published>2015-03-18T23:13:00Z</published><id>posts/2015/03/how-to-find-an-optimal-curvature-threshold/index.html</id><category scheme="/tags/meander.html" term="meander" label="meander"/><category scheme="/tags/enumeration.html" term="enumeration" label="enumeration"/><category scheme="/tags/r.html" term="r" label="r"/><content type="html">&lt;p&gt;
Consecutive span of migration lines with (either time) absolute
curvature, exceeding a certain threshold, define a meander. The lower
the threshold the fewer longer meanders are detected. The higher the
threshold, the fewer extremely bending meanders are detecting. We can
maximize the number of detectable meanders by varying the threshold as
shown on Figure &lt;a href="#fig-curvature-threshold"&gt;1&lt;/a&gt;.
&lt;/p&gt;


&lt;div id="fig-curvature-threshold" class="figure"&gt;
&lt;p&gt;&lt;img src="../../../.././posts/2015/03/how-to-find-an-optimal-curvature-threshold/index/curvature-threshold-bends.svg" alt="curvature-threshold-bends.svg" /&gt;
&lt;/p&gt;
&lt;p&gt;&lt;span class="figure-number"&gt;Figure 1:&lt;/span&gt; Curvature threshold as it affects # of meanders&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
The following snippet will do this.
&lt;/p&gt;

&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R" id="migration"&gt;&lt;span class="org-constant"&gt;library&lt;/span&gt;(rgdal)
Original &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; readOGR(&lt;span class="org-string"&gt;".."&lt;/span&gt;, &lt;span class="org-string"&gt;"lower_mn_1938"&lt;/span&gt;)
Final &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; readOGR(&lt;span class="org-string"&gt;".."&lt;/span&gt;, &lt;span class="org-string"&gt;"lower_mn_2009"&lt;/span&gt;)
Years &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 71
spar &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 0.4
Step_pattern &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="org-string"&gt;'symmetricP05'&lt;/span&gt;
Curvature_multiplier &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 1e5
Step &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 25
&lt;span class="org-constant"&gt;source&lt;/span&gt;(&lt;span class="org-string"&gt;'~/.qgis2/processing/rscripts/Channel migration.rsx'&lt;/span&gt;)
&lt;span class="org-function-name"&gt;ff&lt;/span&gt; &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="org-keyword"&gt;function&lt;/span&gt;(Min_curvature) {
  &lt;span class="org-constant"&gt;source&lt;/span&gt;(&lt;span class="org-string"&gt;'~/.qgis2/processing/rscripts/Meander enumeration.rsx'&lt;/span&gt;, &lt;span class="org-type"&gt;TRUE&lt;/span&gt;)
  max(Enumerated$bend, na.rm=&lt;span class="org-type"&gt;TRUE&lt;/span&gt;)
}
mc &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 10^(seq(-4,-2, by=.1))
nb &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; sapply(mc, ff)
plot(nb~mc, log=&lt;span class="org-string"&gt;'x'&lt;/span&gt;, xlab=&lt;span class="org-string"&gt;'Minimal curvature threshold'&lt;/span&gt;, ylab=&lt;span class="org-string"&gt;'Number of meanders detected'&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;


&lt;div id="fig-meanders-plot" class="figure"&gt;
&lt;p&gt;&lt;img src="../../../.././posts/2015/03/how-to-find-an-optimal-curvature-threshold/index/meanders-count-threshold.svg" alt="meanders-count-threshold.svg" /&gt;
&lt;/p&gt;
&lt;p&gt;&lt;span class="figure-number"&gt;Figure 2:&lt;/span&gt; # of meanders as a function of curvature threshold&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
It is, probably, okay to use threshold value of 1e-3 as can be seen in
Figure &lt;a href="#fig-meanders-plot"&gt;2&lt;/a&gt;. Resulting migration lines with enumerated
meanders are shown in Figure &lt;a href="#fig-qgis-screenshot"&gt;3&lt;/a&gt;.
&lt;/p&gt;


&lt;div id="fig-qgis-screenshot" class="figure"&gt;
&lt;p&gt;&lt;img src="../qgis-processing-channel_migration-demo-screenshot-bends.jpg" alt="qgis-processing-channel_migration-demo-screenshot-bends.jpg" /&gt;
&lt;/p&gt;
&lt;p&gt;&lt;span class="figure-number"&gt;Figure 3:&lt;/span&gt; Example of enumerated meanders highlighted with different colors&lt;/p&gt;
&lt;/div&gt;
</content></entry><entry><title type="html">On effect of curvature multiplier</title><author><name>nil</name></author><link href="http://mlt.github.io/QGIS-Processing-tools/posts/2015/03/on-effect-of-curvature-multiplier/index.html"/><updated>2015-03-18T23:12:00Z</updated><published>2015-03-18T23:12:00Z</published><id>posts/2015/03/on-effect-of-curvature-multiplier/index.html</id><category scheme="/tags/dtw.html" term="dtw" label="dtw"/><category scheme="/tags/r.html" term="r" label="r"/><content type="html">&lt;p&gt;
DTW alignment of original &amp;amp; final channel centerlines is performed
using Euclidean distance matrix for corresponding spline points augmented with the
third dimension of curvature at those points. That is for each point
&lt;i&gt;q&lt;/i&gt; of original centerline and point &lt;i&gt;p&lt;/i&gt; of final centerline, the
matrix of following distances is computed.
&lt;/p&gt;

&lt;p&gt;
\[ d(q,p)=\sqrt{(x_q-x_p)^2 + (y_q-y_p)^2 + \lambda^2(c_q-c_p)^2} \]
&lt;/p&gt;

&lt;p&gt;
, where &amp;lambda; is a &lt;i&gt;Curvature multiplier&lt;/i&gt; parameter.
&lt;/p&gt;

&lt;p&gt;
Since curvature varies a little compared to spatial coordinates
between channel centerlines, we use such multiplier. The following
example demonstrates its impact.
&lt;/p&gt;

&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R" id="multiplier"&gt;&lt;span class="org-constant"&gt;library&lt;/span&gt;(rgdal)
Original &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; readOGR(&lt;span class="org-string"&gt;".."&lt;/span&gt;, &lt;span class="org-string"&gt;"lower_mn_1938"&lt;/span&gt;)
Final &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; readOGR(&lt;span class="org-string"&gt;".."&lt;/span&gt;, &lt;span class="org-string"&gt;"lower_mn_2009"&lt;/span&gt;)
Years &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 71
spar &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 0.4
Step_pattern &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="org-string"&gt;'symmetricP05'&lt;/span&gt;
Curvature_multiplier &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 1e5
Step &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 25
&lt;span class="org-constant"&gt;source&lt;/span&gt;(&lt;span class="org-string"&gt;'~/.qgis2/processing/rscripts/Channel migration.rsx'&lt;/span&gt;)
&lt;span class="org-function-name"&gt;plotResult&lt;/span&gt; &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="org-keyword"&gt;function&lt;/span&gt;() {
  zz &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; subset(Migration, .35 &amp;lt; fr_from &amp;amp; fr_from &amp;lt; .39, drop=&lt;span class="org-type"&gt;TRUE&lt;/span&gt;)
  plot(Original, xlim=bbox(zz)[&lt;span class="org-string"&gt;'x'&lt;/span&gt;,], ylim=bbox(zz)[&lt;span class="org-string"&gt;'y'&lt;/span&gt;,], col=&lt;span class="org-string"&gt;'IndianRed1'&lt;/span&gt;, lwd=2)
  lines(Final, col=&lt;span class="org-string"&gt;'ForestGreen'&lt;/span&gt;, lwd=2)
  &lt;span class="org-keyword"&gt;for&lt;/span&gt;(l &lt;span class="org-keyword"&gt;in&lt;/span&gt; coordinates(zz)[seq(1,length(zz),6)])
    do.call(&lt;span class="org-string"&gt;'arrows'&lt;/span&gt;, c(as.list(t(l[[1]])), length=.05, col=&lt;span class="org-string"&gt;'gray30'&lt;/span&gt;))
  grid(); axis(1); axis(2)
}
layout(matrix(1:2, nrow=1))
plotResult(); title(&lt;span class="org-string"&gt;'a) downstream migration'&lt;/span&gt;)
Curvature_multiplier &lt;span class="org-constant"&gt;&amp;lt;-&lt;/span&gt; 0
&lt;span class="org-constant"&gt;source&lt;/span&gt;(&lt;span class="org-string"&gt;'~/.qgis2/processing/rscripts/Channel migration.rsx'&lt;/span&gt;)
plotResult(); title(&lt;span class="org-string"&gt;'b) lateral migration'&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;


&lt;div class="figure"&gt;
&lt;p&gt;&lt;img src="../../../.././posts/2015/03/on-effect-of-curvature-multiplier/index/multiplier-effect.svg" alt="multiplier-effect.svg" /&gt;
&lt;/p&gt;
&lt;p&gt;&lt;span class="figure-number"&gt;Figure 1:&lt;/span&gt; Migration of a section of Minnesota River a) with curvature b) spatial proximity only&lt;/p&gt;
&lt;/div&gt;
</content></entry>
</feed>
